name: Validate TIBCO BW6 Names

# Trigger only on push to the main branch
on:
  push:
    branches:
      - main

jobs:
  validate-names:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Validate Application/Module/Shared Module Names (kebab-case)
        run: |
          echo "üîç Validating .application, .module, .sharedmodule files for kebab-case naming..."

          violations=0

          validate_kebab_case() {
            local file="$1"
            local type="$2"
            local name

            # Extract the <name> value
            name=$(grep -oPm1 '(?<=<name>)[^<]+' "$file")

            if [[ -z "$name" ]]; then
              echo "‚ö†Ô∏è  No <name> tag found in $file"
              violations=$((violations + 1))
              return
            fi

            echo "üìõ Found $type name: $name"

            # Kebab-case regex
            if [[ ! "$name" =~ ^[a-z0-9]+(-[a-z0-9]+)*$ ]]; then
              echo "‚ùå Invalid $type name '$name' in $file (not kebab-case)"
              violations=$((violations + 1))
            fi
          }

          # Validate .application files
          find . -type f -name "*.application" | while read -r file; do
            validate_kebab_case "$file" "Application"
          done

          # Validate .module files
          find . -type f -name "*.module" | while read -r file; do
            validate_kebab_case "$file" "Module"
          done

          # Validate .sharedmodule files
          find . -type f -name "*.sharedmodule" | while read -r file; do
            validate_kebab_case "$file" "SharedModule"
          done

          if [ $violations -gt 0 ]; then
            echo "‚ùå Found $violations invalid name(s). Please use kebab-case (e.g. 'order-service')."
            exit 1
          else
            echo "‚úÖ All names follow kebab-case."
          fi
