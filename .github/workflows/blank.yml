name: Validate TIBCO BW6 Naming Conventions

on:
  push:
    branches:
      - main

jobs:
  validate-naming:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Validate Application/Module/Parent Project Names
        run: |
          echo "üîç Starting validation of TIBCO BW6 project names..."

          violations=0

          is_kebab_case() {
            [[ "$1" =~ ^[a-z0-9]+(-[a-z0-9]+)*$ ]]
          }

          # Find all relevant .project or *.project files
          find . -type f \( -name ".project" -o -name "*.project" \) | while read -r project_file; do
            folder_path=$(dirname "$project_file")
            folder_name=$(basename "$folder_path")

            proj_name=$(grep -oPm1 '(?<=<name>)[^<]+' "$project_file" || echo "")

            echo "üìÇ Found folder: $folder_name"
            echo "üìÑ Found project name in XML: $proj_name"

            if [[ -z "$proj_name" ]]; then
              echo "‚ö†Ô∏è No <name> tag found in $project_file"
              violations=$((violations + 1))
              continue
            fi

            # Determine the suffix and strip it
            if [[ "$proj_name" == *.module ]]; then
              suffix=".module"
              core_name="${proj_name%.module}"
            elif [[ "$proj_name" == *.parent ]]; then
              suffix=".parent"
              core_name="${proj_name%.parent}"
            else
              suffix=""
              core_name="$proj_name"
            fi

            if ! is_kebab_case "$core_name"; then
              echo "‚ùå Project name '$proj_name' (in $project_file) is not kebab-case"
              violations=$((violations + 1))
            else
              echo "‚úÖ $proj_name is valid."
            fi
          done

          if [ $violations -gt 0 ]; then
            echo "‚ùå Found $violations naming violation(s). Please rename projects to follow kebab-case (e.g., 'order-service')."
            exit 1
          else
            echo "‚úÖ All naming conventions passed!"
          fi
