name: validate-naming

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate Application/Module Naming (Kebab-case)
        run: |
          echo "üîç Validating TIBCO BW6 naming conventions..."

          # Find all .project files
          files=$(find . -name .project)

          status=0

          for file in $files; do
            name=$(grep -oPm1 "(?<=<name>)[^<]+" "$file")
            if [[ ! "$name" =~ ^[a-z0-9]+(-[a-z0-9]+)*(\.module|\.parent)?$ ]]; then
              echo "::error file=$file,line=1::‚ùå ERROR: '$name' is not in kebab-case (e.g. om-notification-service.module)"
              status=1
            else
              echo "‚úÖ $name is valid"
            fi
          done

          if [[ $status -ne 0 ]]; then
            echo ""
            echo "‚ùå Naming validation failed!"
            echo "üí° Please use kebab-case (lowercase and hyphens only): e.g., om-notification-service.module"
            echo "üìò See GitHub Actions logs or PR Checks tab for details."
            exit 1
          else
            echo "‚úÖ All names follow kebab-case."
          fi
