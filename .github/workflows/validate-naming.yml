name: Validate TIBCO BW6 Naming Conventions

on:
  push:
    branches:
      - main

jobs:
  validate-naming:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Validate project names for kebab-case
        shell: bash
        run: |
          echo "üîç Starting TIBCO BW6 naming convention validation..."

          violations=0

          is_kebab_case() {
            [[ "$1" =~ ^[a-z0-9]+(-[a-z0-9]+)*$ ]]
          }

          IFS=$'\n'
          project_files=($(find . -type f \( -name ".project" -o -name "*.project" \)))
          echo "üîé Found ${#project_files[@]} project files."

          for project_file in "${project_files[@]}"; do
            echo "----"
            echo "Checking file: $project_file"
            proj_name=$(grep -oPm1 '(?<=<name>)[^<]+' "$project_file" || echo "")

            echo "Extracted project name: '$proj_name'"

            if [[ -z "$proj_name" ]]; then
              echo "‚ö†Ô∏è No <name> tag found in $project_file"
              violations=$((violations + 1))
              continue
            fi

            if [[ "$proj_name" == *.module ]]; then
              core_name="${proj_name%.module}"
              suffix=".module"
            elif [[ "$proj_name" == *.parent ]]; then
              core_name="${proj_name%.parent}"
              suffix=".parent"
            else
              core_name="$proj_name"
              suffix=""
            fi

            echo "Core name after stripping suffix '$suffix': '$core_name'"

            if is_kebab_case "$core_name"; then
              echo "‚úÖ Name '$proj_name' is valid kebab-case."
            else
              echo "‚ùå Name '$proj_name' is NOT valid kebab-case."
              violations=$((violations + 1))
            fi
          done

          echo "----"
          if (( violations > 0 )); then
            echo "‚ùå Validation failed: $violations naming violation(s) found."
            exit 1
          else
            echo "‚úÖ All project names conform to kebab-case naming."
          fi
